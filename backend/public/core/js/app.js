/*! CountMeIn 2016-06-29 */
var weApp=angular.module("weApp",["ngSanitize","ngAnimate","smart-table","ui.grid","ui.bootstrap","ui.router","ngFileUpload","ngToast"]);weApp.constant("WE_CONSTANTS",function(){var a={NOT_ALLOWED:{ID:999,TITLE:"Niet toegestaan"},DASHBOARD:{ID:0,TITLE:"New event"},DEFAULT:{ID:0,TITLE:"New event"}},b={};return{DEBUG:{BACKEND:!1,ROUTES:!1},BASEPATH:"http://www.devwe.dev/",BACKEND:{},STATES:[{NAME:"dashboard",STATE_CONFIG:["/dashboard","dashboard/dashboard.html","WeDashboardController as weDashboardCtrl",a.DASHBOARD.ID,a.DASHBOARD.TITLE,!1,"page"]}],RIGHTS:[],PAGES:a,SUBVIEWS:b,LOADING_STATES:{LOADING:0,DONE:1,ERROR:2},CONTENT_TYPES:{LINK:0,STRING:1,INTEGER:2,BOOLEAN:3,FLOAT:4}}}()),weApp.factory("WeMainService",["WE_CONSTANTS",function(a){function b(a,b,c,d){var e=this;e.id=a,e.initialLoadingState=b,e.title=c}return{isLoaded:!1,page:new b(a.PAGES.DEFAULT,a.LOADING_STATES.DONE,"",null),subview:new b(null,a.LOADING_STATES.DONE,"",null),user:{},promises:{user:null}}}]),weApp.run(["WeMainService","WeBackendService","$q","$window","WE_CONSTANTS","$rootScope","$state",function(a,b,c,d,e,f,g){e.BASEPATH,d.location.href;a.isLoaded=!0}]),weApp.config(["$stateProvider","$urlRouterProvider","WE_CONSTANTS",function(a,b,c){function d(a,b,d,e,f,g,h){return{"abstract":g,url:a,templateUrl:b,controller:d,resolve:{userPromise:["WeMainService",function(a){a[h].id=e,a[h].title=f,a[h].initialLoadingState=c.LOADING_STATES.LOADING}]}}}var e=c.STATES;b.otherwise("/dashboard");for(var f=0;f<e.length;f++)a.state(e[f].NAME,d.apply(this,e[f].STATE_CONFIG))}]),weApp.factory("WeBackendService",["$http","WE_CONSTANTS",function(a,b){function c(c,d,e,f){return b.DEBUG.BACKEND&&(console.log("POST arguments for backend request '"+c+"':"),console.log(d)),a.post(c,$.param(d),{headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then(function(a){b.DEBUG.BACKEND&&(console.log("Response for backend request '"+c+"':"),console.log(a)),null!==e.STATUS_KEY&&a.data[e.STATUS_KEY]==e.STATUS_SUCCESS?f(a.data[e.DATA_KEY]):null===e.STATUS_KEY&&a.data?f(a.data):(console.log("Calling "+c+" failed. Status: "+a.data[e.STATUS_KEY]),f(!1))},function(a){console.log("An error occurred while calling "+c),console.log("Error:"),console.log(a),f(!1)})}function d(a){return function(){for(var b=arguments[arguments.length-1],d={},e=0;e<arguments.length-1;e++)d[a.POST[e]]=arguments[e];return c(a.URL,d,a.RESULT,b)}}var e=b.BACKEND,f={};for(var g in e)f[e[g].NAME]=d(e[g]);return f}]),weApp.controller("WeMainCtrl",["WeMainService","WeBackendService","$window","WE_CONSTANTS",function(a,b,c,d){var e=this,f=d.BASEPATH;e.mainService=a,e.WE_PAGES=d.PAGES,e.LOADING_STATES=d.LOADING_STATES,e.overlayMessage="App wordt geladen...",e.logOut=function(){e.mainService.isLoaded=!1,e.overlayMessage="App wordt afgesloten...",b.logOut(function(a){c.location.href=f+"architecture/prototype2/app/signin"})}}]),weApp.factory("WeToolService",[function(){return{findWithAttr:function(a,b,c){for(var d=0;d<a.length;d+=1)if(a[d][b]===c)return d}}}]),weApp.directive("weList",["WE_CONSTANTS",function(a){return{templateUrl:"components/list/list.html",restrict:"E",scope:{weListTarget:"="},link:function(b,c,d){b.CONTENT_TYPES=a.CONTENT_TYPES}}}]),weApp.directive("weTabs",[function(){return{template:'<div class="l-we-tabs"><div class="visible-xs dropdown"><button class="btn btn-default dropdown-toggle" type="button" id="dropdownMenu-{{name}}" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">{{name}}<span class="caret"></span></button><ul class="dropdown-menu" aria-labelledby="dropdownMenu-{{name}}"><li ng-repeat="tab in tabs"><a ng-click="activeObject[activeKey] = tab.active" href="{{tab.url}}">{{tab.name}}</a></li></ul></div><ul class="visible-sm visible-md visible-lg nav nav-tabs"><li ng-repeat="tab in tabs track by $index" role="presentation" ng-class="{active: activeObject[activeKey] == tab.active}"><a href="{{tab.url}}" ng-click="activeObject[activeKey] = tab.active">{{tab.name}}</a></li></ul></div>',scope:{name:"@",tabs:"=",activeObject:"=",activeKey:"@"}}}]),weApp.directive("weDatepicker",[function(){return{template:'<p class="input-group"><input type="text"class="form-control"uib-datepicker-popup="{{format}}"ng-model="targetObject[targetModel]"is-open="datepicker.opened"datepicker-options="weDateOptions"ng-required="true"close-text="Close"alt-input-formats="altInputFormats" /><span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="openDatepicker()"><i class="fa fa-calendar" aria-hidden="true"></i></button></span></p>',scope:{targetObject:"=",targetModel:"@",weDateOptions:"="},link:function(a,b,c){a.datepicker={opened:!1},a.formats=["dd-MM-yyyy","dd-MMMM-yyyy","yyyy/MM/dd","dd.MM.yyyy","shortDate"],a.format=a.formats[0],a.altInputFormats=["M!/d!/yyyy"],a.openDatepicker=function(){a.datepicker.opened=!0}}}}]),weApp.directive("weDataLoading",[function(){return{template:'<div class="l-we-data-loading text-center"><i class="fa fa-spinner fa-spin fa-3x fa-fw"></i><p>Data wordt opgehaald...</p></div>'}}]),weApp.directive("weTextEditor",["$interval",function(a){return{template:'<textarea class="weMarkdownEditor" ng-model="targetObject[targetInputKey]" rows="10"></textarea>',scope:{targetObject:"=",targetInputKey:"@",targetOutputKey:"@"},restrict:"E",link:function(a,b,c){var d=a.targetObject,e=a.targetInputKey,f=a.targetOutputKey;$(b).children(".weMarkdownEditor").markdown({autofocus:!1,saveable:!0,fullscreen:!1,hiddenButtons:"cmdImage cmdUrl cmdHeading cmdList cmdList0 cmdCode cmdQuote cmdPreview",onChange:function(b){a.$apply(function(){d[f]=marked(b.getContent(),{sanitize:!0})})}}),a.$watch("targetObject[targetInputKey]",function(a,b){a&&(d[f]=marked(d[e],{sanitize:!0}))})}}}]),weApp.directive("weObjectStructure",[function(){return{template:'<div class="panel panel-default"><div class="panel-heading">{{title}}</div><div class="panel-body"><span ng-show="targetObject[targetKey] == null"><we-data-loading></we-data-loading></span><span ng-show="targetObject[targetKey] != null"><ul><li ng-repeat="(key, value) in targetObject[targetKey]">{{key}} <i>{{getTypeof(value)}}</i></li></ul></span></div></div>',restrict:"E",scope:{title:"@",targetObject:"=",targetKey:"@"},link:function(a,b,c){a.getTypeof=function(a){return typeof a}}}}]),weApp.directive("weInputGroup",[function(){return{restrict:"E",scope:{editMode:"@",keys:"=",source:"=",units:"@",lockdown:"=",lockdownKey:"@",model:"="},template:'<div class="row"><div ng-repeat="(key, value) in keys" class="l-we-input-pair-wrapper {{units}}"><div class="row"><div class="col-xs-6 text-right">{{value.heading}} :&nbsp;</div><div class="col-xs-6 text-left"><span ng-if="editMode == \'false\'"><span ng-if="value.url === false">{{source[key]}}</span><span ng-if="value.url === true"><a href="{{value.urlFunction(source)}}">{{source[key]}}</a></span></span><span ng-if="editMode == \'true\'"><span ng-if="value.colEditType == \'notEditable\'"><span ng-if="value.url === false">{{source[key]}}</span><span ng-if="value.url === true"><a href="{{value.urlFunction(source)}}">{{source[key]}}</a></span></span><input ng-disabled="lockdown[lockdownKey] === true" ng-if="value.colEditType == \'string\'" class="form-control" type="text" ng-model="model[key]" /><input ng-disabled="lockdown[lockdownKey] === true" ng-if="value.colEditType == \'number\'" class="form-control" type="number" ng-model="model[key]" /><input ng-disabled="lockdown[lockdownKey] === true" ng-if="value.colEditType == \'password\'" class="form-control" type="password" ng-model="model[key]" /><input ng-disabled="lockdown[lockdownKey] === true" ng-if="value.colEditType == \'email\'" class="form-control" type="email" ng-model="model[key]" /><select ng-disabled="lockdown[lockdownKey] === true" ng-if="value.colEditType == \'select\'" class="form-control" ng-model="model[key]" ng-options="name.id as name.name for name in value.selectOptions"></select></span></div></div></div></div>'}}]),weApp.directive("weTable",["WeToolService","$interval",function(a,b){return{template:'<div class="we-table-wrapper" ><div st-table="displayedCollection" st-safe-src="targetObject"><div class="we-table-xs we-table-sm visible-xs visible-sm"><table class="table table-striped"><thead><tr ng-if="options.title !== \'\' "><th>{{options.title}}</th></tr><tr><th><div ng-if="options.globalSearch === true" class="row"><div class="col-xs-12"><input ng-disabled="lockdown[lockdownKey] === true" st-search placeholder="Zoek..." class="input-sm form-control" type="search"/></div></div></th></tr></thead><tbody><tr ng-repeat="row in displayedCollection track by $index"><td><we-input-group  edit-mode="{{targetObject.indexOf(row) == rowBeingEdited}}" keys="keys" source="row" units="col-xs-12" lockdown="lockdown" lockdown-key="lockdownKey" model="editingRow"></we-input-group><p ng-if="options.editEnabled || options.deleteEnabled" class="l-we-table-mobile-buttons-wrapper text-center"><span ng-if="targetObject.indexOf(row) != rowBeingEdited"><button ng-disabled="lockdown[lockdownKey] === true" ng-if="options.editEnabled" class="btn btn-primary l-we-table-btn" ng-click="editRow(row)">Edit</button><button ng-disabled="lockdown[lockdownKey] === true" ng-if="options.deleteEnabled" class="btn btn-danger l-we-table-btn" ng-click="deleteRow(row)">Delete</button></span><span ng-if="targetObject.indexOf(row) == rowBeingEdited"><button ng-disabled="lockdown[lockdownKey] === true" class="btn btn-primary l-we-table-btn" ng-click="saveRow(editingRow)">Save</button><button ng-disabled="lockdown[lockdownKey] === true" class="btn btn-primary l-we-table-btn" ng-click="cancelEdit()">Undo</button></span></p></td></tr></tbody></table><div ng-if="options.pagination" class="text-center"><div st-pagination="" st-items-by-page="options.itemsByPage" st-displayed-pages="options.displayedPages"></div></div></div><div class="we-table-md we-table-lg visible-md visible-lg"><div class="we-table-body-wrapper {{options.scrollable === true ? \'we-table-scrollable\' : \'\' }}"><table class="table table-striped"><thead><tr><th ng-if="options.selectable === true"></th><th ng-repeat="(key, value) in keys" st-class-ascent="we-table-sort-ascent" st-class-descent="we-table-sort-descent" ng-class="{\'we-table-sortable-heading\': value.sorting === true }" st-sort="{{ value.sorting === true ? key : null }}" style="{{value.styling}}">{{value.heading}}</th><th ng-if="options.editEnbled || options.deleteEnabled"></th></tr><tr ng-if="options.globalSearch === true"><th colspan="999"><div class="row"><div class="col-sm-6 col-md-4"><input ng-disabled="lockdown[lockdownKey] === true" st-search placeholder="Zoek..." class="input-sm form-control" type="search"/></div></div></th></tr></thead><tbody><tr ng-repeat="row in displayedCollection track by $index"><td ng-if="options.selectable === true"><input type="checkbox" ng-model="checks[targetObject.indexOf(row)]" /></td><td ng-if="targetObject.indexOf(row) != rowBeingEdited" ng-repeat="(key, value) in keys" style="{{value.stying}}"><span ng-if="value.url === false">{{row[key]}}</span><span ng-if="value.url === true"><a href="{{value.urlFunction(row)}}">{{row[key]}}</a></span></td><td ng-if="targetObject.indexOf(row) == rowBeingEdited" ng-repeat="(key, value) in keys" style="{{value.styling}}"><input ng-disabled="lockdown[lockdownKey] === true" ng-if="value.colEditType == \'string\'" class="form-control" type="text" ng-model="editingRow[key]" /><input ng-disabled="lockdown[lockdownKey] === true" ng-if="value.colEditType == \'number\'" class="form-control" type="number" ng-model="editingRow[key]" /><input ng-disabled="lockdown[lockdownKey] === true" ng-if="value.colEditType == \'password\'" class="form-control" type="password" ng-model="editingRow[key]" /><input ng-disabled="lockdown[lockdownKey] === true" ng-if="value.colEditType == \'email\'" class="form-control" type="email" ng-model="editingRow[key]" /><select ng-disabled="lockdown[lockdownKey] === true" ng-if="value.colEditType == \'select\'" class="form-control" ng-model=editingRow[key] ng-options="name.id as name.name for name in value.selectOptions"><!--<option value="">{{selectPlaceholder}}</option>--></select><span ng-if="value.colEditType == \'notEditable\'"><span ng-if="value.url === false">{{row[key]}}</span><span ng-if="value.url === false"><a href="{{value.urlFunction(row)}}">{{row[key]}}</a></span></span></td><td ng-if="options.editEnabled || options.deleteEnabled" class="text-right"><span ng-if="targetObject.indexOf(row) != rowBeingEdited"><button ng-disabled="lockdown[lockdownKey] === true" ng-if="options.editEnabled" class="btn btn-primary l-we-table-btn" ng-click="editRow(row)">Edit</button><button ng-disabled="lockdown[lockdownKey] === true" ng-if="options.deleteEnabled" class="btn btn-danger l-we-table-btn" ng-click="deleteRow(row)">Delete</button></span><span ng-if="targetObject.indexOf(row) == rowBeingEdited"><button ng-disabled="lockdown[lockdownKey] === true" class="btn btn-primary l-we-table-btn" ng-click="saveRow(editingRow)">Save</button><button ng-disabled="lockdown[lockdownKey] === true" class="btn btn-primary l-we-table-btn" ng-click="cancelEdit()">Undo</button></span></td></tr></tbody></table></div><div ng-if="options.pagination" class="text-center"><div st-pagination="" st-items-by-page="options.itemsByPage" st-displayed-pages="options.displayedPages"></div></div></div></div></div>',restrict:"E",scope:{targetObject:"=",options:"=",keys:"=",lockdown:"=",lockdownKey:"@",saveObject:"=",deleteObject:"=",saveFunction:"@",deleteFunction:"@"},link:function(a,b,c){a.rowBeingEdited=-1,a.editingRow={},a.checks=[],a.editRow=function(b){a.editingRow=angular.copy(b),a.rowBeingEdited=a.targetObject.indexOf(b)},a.cancelEdit=function(){a.rowBeingEdited=-1},a.saveRow=function(b){a.lockdown[a.lockdownKey]=!0,a.saveObject[a.saveFunction](b,function(){a.cancelEdit(),a.lockdown[a.lockdownKey]=!1})},a.deleteRow=function(b){a.lockdown[a.lockdownKey]=!0,a.deleteObject[a.deleteFunction](b,function(){a.lockdown[a.lockdownKey]=!1})}}}}]),weApp.directive("weD3Lines",[function(){return{restrict:"EA",scope:{options:"=",data:"="},link:function(a,b,c){function d(){j.selectAll("line").remove(),j.selectAll("path").remove(),j.selectAll("text").remove(),m.domain([0,1.02*d3.max(n)]).nice(),l.domain([0,o.length-1]).nice(),f=d3.svg.axis().scale(m).orient("left").ticks(10).innerTickSize(-h).tickPadding(10),e=d3.svg.axis().scale(l).orient("bottom").ticks(o.length-1).tickFormat(function(a){return o[a]}),k.append("g").attr("class","we-chart-axis we-bottom-text").attr("transform","translate(0, "+i+")").call(e).append("text").attr("x",h).attr("y",-6).style("text-anchor","end").text(p),k.append("g").attr("class","we-chart-axis").call(f).append("text").attr("transform","rotate(-90)").attr("y",6).attr("dy",".71rem").style("text-anchor","end").text(q);for(var a=0;a<n.length;a++)a<n.length-1&&k.append("line").attr("x1",l(a)).attr("y1",m(n[a])).attr("x2",l(a+1)).attr("y2",m(n[a+1])).style("stroke",r),k.append("circle").attr("cx",l(a)).attr("cy",m(n[a])).attr("r",3.5).style("fill","white").style("stroke",r)}var e,f,g={top:20,right:20,bottom:30,left:40},h=a.options.width-g.left-g.right,i=a.options.height-g.top-g.bottom,j=d3.select(b[0]).append("svg").attr("width",h+g.left+g.right).attr("height",i+g.left+g.right),k=j.append("g").attr("transform","translate("+g.left+","+g.top+")"),l=d3.scale.linear().range([0,h]),m=d3.scale.linear().range([i,0]),n=a.data.data,o=a.data.units,p=a.options.descriptionXAxis,q=a.options.descriptionYAxis,r=a.options.customColor;a.options.watch===!0&&a.$watch("data.data",function(){d()}),d()}}}]),weApp.controller("WeDashboardController",["WeMainService","WE_CONSTANTS","WeToolService",function(a,b,c){var d=this,e=(a.user.token,0);d.eventDetails={organiser:{firstName:null,lastName:null,email:null},name:null,date:null,description:null,participants:[]},d.newParticipant={firstName:null,lastName:null,email:null},d.lockdown={status:!1},d.myObj={textEditor:"",textOutput:""},d.tableData={options:{title:"Participants",globalSearch:!0,scrollable:!1,pagination:!0,editEnabled:!0,deleteEnabled:!0,selectable:!1,itemsByPage:5,displayedPages:4},keys:{firstName:{heading:"First name",styling:"width:26%;",sorting:!0,colEditType:"string",url:!1},lastName:{heading:"Last name",styling:"width:26%;",sorting:!0,colEditType:"string",url:!1},email:{heading:"email",styling:"width:26%;",sorting:!0,colEditType:"email",url:!1}}},d.addParticipant=function(){var a;d.newParticipant.id=e++,a=angular.copy(d.newParticipant),d.eventDetails.participants.push(a),d.newParticipant.firstName=null,d.newParticipant.lastName=null,d.newParticipant.email=null},d.updateEntry=function(a,b){var e=c.findWithAttr(d.eventDetails.participants,"id",a.id);angular.copy(a,d.eventDetails.participants[e]),console.log(a),b()},d.deleteEntry=function(a,b){var e=c.findWithAttr(d.eventDetails.participants,"id",a.id);d.eventDetails.participants.splice(e,1),console.log(a),b()},d.checkParticipantFields=function(){return null===d.newParticipant.firstName||""===d.newParticipant.firstName||null===d.newParticipant.lastName||""===d.newParticipant.lastName||null===d.newParticipant.email||""===d.newParticipant.email},d.checkAllFields=function(){return!(null!==d.eventDetails.organiser.firstName&&""!==d.eventDetails.organiser.firstName&&null!==d.eventDetails.organiser.lastName&&""!==d.eventDetails.organiser.lastName&&null!==d.eventDetails.organiser.email&&""!==d.eventDetails.organiser.email&&null!==d.eventDetails.name&&""!==d.eventDetails.name&&null!==d.eventDetails.date&&""!==d.eventDetails.date&&0!==d.eventDetails.date&&null!==d.eventDetails.description&&""!==d.eventDetails.description&&d.eventDetails.participants.length>0)},d.processInvitations=function(){d.lockdown.status=!0,console.log("Sending to the backend:"),console.log(d.eventDetails)},a.page.initialLoadingState=b.LOADING_STATES.DONE}]);